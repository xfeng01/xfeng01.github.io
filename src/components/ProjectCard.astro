---
import type { CollectionEntry } from 'astro:content';

interface Props {
  project: CollectionEntry<'projects'>;
}

const { project } = Astro.props;
const { title, image, link, authors, pub, description, code, poster, blog } = project.data;
const yourName = "Xinsong Feng";
const { Content } = await project.render();

// Generate unique ID for this project card
const projectId = `project-${project.slug}`;
const imageId = `image-${project.slug}`;
---
<div class="flex flex-col md:flex-row items-start gap-6 mb-8">
  {image && (
    <div class="w-full md:w-1/3 flex-shrink-0">
      <img 
        src={image} 
        alt={`Image for ${title}`} 
        class="rounded-md border border-gray-200 w-full cursor-pointer hover:opacity-90 transition-opacity" 
        onclick={`openImage('${imageId}')`}
      />
    </div>
  )}
  <div class="w-full md:w-2/3">
    <h3 class="text-base font-semibold mb-1 text-gray-900">
      {title}
    </h3>
    <p class="text-sm text-gray-600 mb-1">
      {authors.map((author: string, index: number) => (
        <span class={author === yourName ? 'font-semibold underline' : ''}>
          {author}{index < authors.length - 1 ? ', ' : ''}
        </span>
      ))}
    </p>
    <p class="text-sm text-gray-800 mb-2">
      <span class="italic">{pub}</span>
    </p>
    
    <!-- Short Description (always visible) -->
    {description && (
      <p class="text-sm text-gray-700 mb-3 leading-relaxed">
        {description}
      </p>
    )}
    
    <!-- Buttons -->
    <div class="flex flex-wrap gap-2 mb-3">
      <button 
        class="px-3 py-1 text-xs border border-gray-300 rounded hover:bg-gray-100 transition-colors text-gray-900"
        onclick={`toggleAbstract('${projectId}')`}
      >
        ABSTRACT
      </button>
      {link && (
        <a 
          href={link} 
          target="_blank" 
          rel="noopener noreferrer"
          class="px-3 py-1 text-xs border border-gray-300 rounded hover:bg-gray-100 transition-colors inline-block"
          style="color: #111827; text-decoration: none;"
        >
          LINK
        </a>
      )}
      {poster && (
        <a 
          href={poster} 
          target="_blank" 
          rel="noopener noreferrer"
          class="px-3 py-1 text-xs border border-gray-300 rounded hover:bg-gray-100 transition-colors inline-block"
          style="color: #111827; text-decoration: none;"
        >
          POSTER
        </a>
      )}
      {code && (
        <a 
          href={code} 
          target="_blank" 
          rel="noopener noreferrer"
          class="px-3 py-1 text-xs border border-gray-300 rounded hover:bg-gray-100 transition-colors inline-block"
          style="color: #111827; text-decoration: none;"
        >
          CODE
        </a>
      )}
      {blog && (
        <a 
          href={blog} 
          target="_blank" 
          rel="noopener noreferrer"
          class="px-3 py-1 text-xs border border-gray-300 rounded hover:bg-gray-100 transition-colors inline-block"
          style="color: #111827; text-decoration: none;"
        >
          BLOG
        </a>
      )}
    </div>

    <!-- Collapsible Abstract -->
    <div id={projectId} class="hidden mt-3 p-4 bg-gray-50 border border-gray-200 rounded text-sm text-gray-700 leading-relaxed">
      <Content />
    </div>
  </div>
</div>

<!-- Image Lightbox -->
{image && (
  <div 
    id={imageId} 
    class="hidden fixed inset-0 bg-black bg-opacity-90 z-50 flex items-center justify-center p-4"
    onclick={`closeImage('${imageId}')`}
  >
    <img 
      src={image} 
      alt={`Full size ${title}`} 
      class="max-w-full max-h-full object-contain"
      onclick="event.stopPropagation()"
    />
    <button 
      class="absolute top-4 right-4 text-white text-4xl font-light hover:text-gray-300"
      onclick={`closeImage('${imageId}')`}
    >
      Ã—
    </button>
  </div>
)}

<script>
  function toggleAbstract(id: string) {
    const element = document.getElementById(id);
    if (element) {
      element.classList.toggle('hidden');
    }
  }
  
  function openImage(id: string) {
    const element = document.getElementById(id);
    if (element) {
      element.classList.remove('hidden');
      document.body.style.overflow = 'hidden';
    }
  }
  
  function closeImage(id: string) {
    const element = document.getElementById(id);
    if (element) {
      element.classList.add('hidden');
      document.body.style.overflow = 'auto';
    }
  }
  
  // Make functions available globally
  (window as any).toggleAbstract = toggleAbstract;
  (window as any).openImage = openImage;
  (window as any).closeImage = closeImage;
</script>
