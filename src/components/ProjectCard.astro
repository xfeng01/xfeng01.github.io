---
import type { CollectionEntry } from 'astro:content';

interface Props {
  project: CollectionEntry<'projects'>;
}

const { project } = Astro.props;
const { title, image, link, authors, pub, description, code, poster, blog } = project.data;
const yourName = "Xinsong Feng";
const { Content } = await project.render();

// Generate unique ID for this project card
const projectId = `project-${project.slug}`;
---
<div class="flex flex-col md:flex-row items-start gap-6 mb-8">
  {image && (
    <div class="w-full md:w-1/3 flex-shrink-0">
      <img src={image} alt={`Image for ${title}`} class="rounded-md border border-gray-200 w-full" />
    </div>
  )}
  <div class="w-full md:w-2/3">
    <h3 class="text-base font-semibold mb-1">
      {link ? (
        <a href={link} target="_blank" rel="noopener noreferrer" class="hover:text-blue-700">
          {title}
        </a>
      ) : (
        title
      )}
    </h3>
    <p class="text-sm text-gray-600 mb-1">
      {authors.map((author: string, index: number) => (
        <span class={author === yourName ? 'font-semibold underline' : ''}>
          {author}{index < authors.length - 1 ? ', ' : ''}
        </span>
      ))}
    </p>
    <p class="text-sm text-gray-800 mb-2">
      <span class="italic">{pub}</span>
    </p>
    
    <!-- Short Description (always visible) -->
    {description && (
      <p class="text-sm text-gray-700 mb-3 leading-relaxed">
        {description}
      </p>
    )}
    
    <!-- Buttons -->
    <div class="flex flex-wrap gap-2 mb-3">
      <button 
        class="px-3 py-1 text-xs border border-gray-300 rounded hover:bg-gray-100 transition-colors"
        onclick={`toggleAbstract('${projectId}')`}
      >
        ABSTRACT
      </button>
      {link && (
        <a 
          href={link} 
          target="_blank" 
          rel="noopener noreferrer"
          class="px-3 py-1 text-xs border border-gray-300 rounded hover:bg-gray-100 transition-colors inline-block"
        >
          LINK
        </a>
      )}
      {code && (
        <a 
          href={code} 
          target="_blank" 
          rel="noopener noreferrer"
          class="px-3 py-1 text-xs border border-gray-300 rounded hover:bg-gray-100 transition-colors inline-block"
        >
          CODE
        </a>
      )}
      {poster && (
        <a 
          href={poster} 
          target="_blank" 
          rel="noopener noreferrer"
          class="px-3 py-1 text-xs border border-gray-300 rounded hover:bg-gray-100 transition-colors inline-block"
        >
          POSTER
        </a>
      )}
      {blog && (
        <a 
          href={blog} 
          target="_blank" 
          rel="noopener noreferrer"
          class="px-3 py-1 text-xs border border-gray-300 rounded hover:bg-gray-100 transition-colors inline-block"
        >
          BLOG
        </a>
      )}
    </div>

    <!-- Collapsible Abstract -->
    <div id={projectId} class="hidden mt-3 p-4 bg-gray-50 border border-gray-200 rounded text-sm text-gray-700 leading-relaxed">
      <Content />
    </div>
  </div>
</div>

<script>
  function toggleAbstract(id: string) {
    const element = document.getElementById(id);
    if (element) {
      element.classList.toggle('hidden');
    }
  }
  // Make function available globally
  (window as any).toggleAbstract = toggleAbstract;
</script>
